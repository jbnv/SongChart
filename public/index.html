<html>
<head>
<!-- Library -->
<script src="/lib/angular.js" charset="utf-8"></script>
<script src="/lib/ui-bootstrap-tpls-0.11.0.js" charset="utf-8"></script>
<link rel="stylesheet" type="text/css" href="/lib/bootstrap.css"></link>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<!-- Application -->
<script src="/js/songChartController.js" charset="utf-8"></script>
<script src="/js/songModalController.js" charset="utf-8"></script>
<script>
	var songChartApp = angular.module('songChartApp', ['ui.bootstrap']);
	songChartApp.controller('songChartController', 
		['$scope','$filter','$http','$modal',SongChartController]);
	songChartApp.controller('songModalController', 
		['$scope','$modalInstance','song',SongModalController]);
</script>
</head>

<script>
</script>

<body data-ng-app="songChartApp" data-ng-controller="songChartController">

<nav role="navigation" class="navbar navbar-default navbar-fixed-top">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
        <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
    </div>
    <!-- Collection of nav links and other content for toggling -->
    <div id="navbarCollapse" class="collapse navbar-collapse">
        <ul role="navigation" class="nav navbar-nav">
            <li class="dropdown">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.decade}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="decade in [1970,1980,1990] | orderBy: identity" 
						data-ng-click="setFilter({'decade':decade})"
					><a href="#">{{decade}}s</a></li>
                </ul>
			</li>
            <li class="dropdown" data-ng-show="filter.decade > 0">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.year}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="i in [0,1,2,3,4,5,6,7,8,9]" 
						data-ng-click="setFilter({'year':filter.decade+i})"
					><a href="#">{{filter.decade+i}}</a></li>
                </ul>
            </li>
            <li class="dropdown" data-ng-show="filter.year > 0">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.month}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="month in months" 
						data-ng-click="setFilter({'year':filter.year,'month':$index+1})"
					><a href="#">{{month}}</a></li>
                </ul>
            </li>
			<li data-ng-hide="showSpinner">
				<a tooltip-placement="bottom" tooltip="Songs Loaded">{{ displayArray.length }} <i class="fa fa-music"></i></a>
			</li>
			<li data-ng-hide="showSpinner">
				<a tooltip-placement="bottom" tooltip="Artists Loaded">TODO <i class="fa fa-paint-brush"></i></a>
			</li>
        </ul>
		<ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">Show Column <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    <li
						data-ng-repeat="(slug,details) in columns | filter: {hidden:true}"
						data-ng-click="columns.show(slug)"
					><a href="#">{{details.title}}</a></li>
                </ul>
            </li>
			<li>
				<ul class="btn-group">
					<li 
						data-ng-click="reload()"
						class="btn btn-default" 
						tooltip-placement="bottom" tooltip="Reload content for current query."
					><i data-ng-hide="showSpinner" class="fa fa-2x fa-refresh"></i>
					<i data-ng-show="showSpinner" class="fa fa-2x fa-refresh fa-spin"></i>
					</li>
					<li 
						data-ng-click="init()"
						class="btn btn-default" 
						tooltip-placement="bottom" tooltip="Reset query."
					><i class="fa fa-2x fa-undo"></i>
					</li>
				</ul>
			</li>
		</ul>
	</div>
</nav>

<br /><br/ ><br/ ><br/ ><!-- spacer to move table underneath nav bar -->

<table class="table table-condensed table-hover" data-ng-show="displayArray.length > 0">
	<thead>
		<tr>
			<th data-ng-show="showRank">Rank</th>
			<th data-ng-hide="columns.title.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">Title</a>
					<ul class="dropdown-menu">
						<li data-ng-click="setSort('title')"><a href="#"><i class="fa fa-sort-alpha-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-title')"><a href="#"><i class="fa fa-sort-alpha-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('title')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.artist.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">Artist</a>
					<ul class="dropdown-menu">
						<li data-ng-click="setSort('artistObject.name')"><a href="#"><i class="fa fa-sort-alpha-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-artistObject.name')"><a href="#"><i class="fa fa-sort-alpha-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('artist')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-show="showDate">Date</th>
			<th data-ng-show="showIsDebut"></th>
			<th data-ng-hide="columns.score.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">Score</a>
					<ul class="dropdown-menu">
						<li data-ng-click="setSort('score')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-score')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('score')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-show="showProjectedRank" tooltip="Projected Rank">PR</th>
			<th data-ng-hide="columns.debutRank.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">D</a>
					<ul class="dropdown-menu">
						<li><b>Debut Rank (D)</b>
						<li data-ng-click="setSort('debutRank')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-debutRank')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('debutRank')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.peakRank.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">P</a>
					<ul class="dropdown-menu">
						<li><b>Peak Rank (P)</b></li>
						<li data-ng-click="setSort('peakRank')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-peakRank')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('peakRank')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.duration.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">M</a>
					<ul class="dropdown-menu">
						<li><b>Duration (Months) (M)</b></li>
						<li data-ng-click="setSort('duration')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-duration')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('duration')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.k.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">K</a>
					<ul class="dropdown-menu">
						<li><b>Coefficient Constant (K)</b></li>
						<li data-ng-click="setSort('coefficientConstant')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-coefficientConstant')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('k')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.a.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">A</a>
					<ul class="dropdown-menu">
						<li><b>Ascent Coefficient</b></li>
						<li data-ng-click="setSort('ascentCoefficient')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-ascentCoefficient')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('a')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.d.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">B</a>
					<ul class="dropdown-menu">
						<li><b>Descent Coefficient</b></li>
						<li data-ng-click="setSort('descentCoefficient')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-descentCoefficient')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('d')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
			<th data-ng-hide="columns.timeToPeak.hidden">
				<div class="dropdown">
					<a href="#" data-toggle="dropdown" class="dropdown-toggle">H</a>
					<ul class="dropdown-menu">
						<li><b>Time to Peak (H)</b></li>
						<li data-ng-click="setSort('timeToPeak')"><a href="#"><i class="fa fa-sort-numeric-asc"></i> Order Ascending</a></li>
						<li data-ng-click="setSort('-timeToPeak')"><a href="#"><i class="fa fa-sort-numeric-desc"></i> Order Descending</a></li>
						<li data-ng-click="columns.hide('timeToPeak')"><a href="#"><i class="fa fa-remove"></i> Remove</a></li>
					</ul>
				</div>
			</th>
		</tr>
	</thead>
	<tbody>
		<tr data-ng-repeat="song in displayArray | orderBy:sortPredicate">
			<td data-ng-show="showRank">{{ $index+1 }}</td>
			<td data-ng-hide="columns.title.hidden"><a href="#" data-ng-click="openSongModal(song)">{{song.title}}</a></td>
			<td data-ng-hide="columns.artist.hidden"><a href="http://playlists.wikidot.com/{{ song.artist }}">{{ song.artistObject.name }}</a></td>
			<td data-ng-show="showDate">{{dateString(song)}}</td>
			<th data-ng-show="showIsDebut"><i class="fa fa-star" data-ng-show="song.isDebut"></i></th>
			<td data-ng-hide="columns.score.hidden">{{ song.score | number:1 }}</td>
			<td data-ng-show="showProjectedRank">{{formatProjectedRank(song.projectedRank)}}</td>
			<td data-ng-hide="columns.debutRank.hidden">{{song.debutRank}}</td>
			<td data-ng-hide="columns.peakRank.hidden">{{song.peakRank}}</td>
			<td data-ng-hide="columns.duration.hidden"><span data-ng-show="showProjectedRank">{{song.monthIndex}} / </span>{{song.duration}}</td>
			<td data-ng-hide="columns.k.hidden">{{ song.coefficientConstant | number:2 }}</td>
			<td data-ng-hide="columns.a.hidden">{{ song.ascentCoefficient | number:2 }}</td>
			<td data-ng-hide="columns.b.hidden">{{ song.descentCoefficient | number:2 }}</td>
			<td data-ng-hide="columns.timeToPeak.hidden">{{ song.timeToPeak | number:2 }}</td>
		</tr>
	</tbody>
</table>

<script type="text/ng-template" id="songModal.html">
	<div class="modal-header">
		<h3 class="modal-title">
			<a href="http://playlists.wikidot.com/{{ song.fullname }}">{{song.title}}</a><br>
			<small><a href="http://playlists.wikidot.com/{{ song.artist }}">{{ song.artistObject.name }}</a></small>
		</h3>
	</div>
	<div class="modal-body">
		<table class="table table-condensed table-hover">
			<tr><td>Debut Date</td><td><a href="http://playlists.wikidot.com/{{ song.date }}">{{ song.date }}</a></td></tr>
			<tr><td>Total Score</td><td>{{ song.score | number:1 }}</td></tr>
			<tr><td>Debut/Peak Rank</td><td>{{ song.debutRank }} / {{ song.peakRank }}</td></tr>
			<tr><td>Duration</td><td>{{ song.duration }}</td></tr>
			<tr><td>Duration</td><td>{{ song.duration }}</td></tr>
			<tr><td>Ascent/Descent K</td><td>{{ song.ascentCoefficient | number:2 }} / {{ song.descentCoefficient | number:2 }}</td></tr>
			<tr><td><b>Ranks</b></td><td>&nbsp;</td></tr>
			<tr data-ng-repeat="rankObject in song.pointRanks | orderBy:index"><td>{{ rankObject.m | number:1 }}</td><td>{{ rankObject.rank | number:2 }}</td></tr>
		</table>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="ok()">Close</button>
	</div>
</script>

</body>
</html>
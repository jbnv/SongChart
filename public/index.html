<html>
<head>
<!-- Library -->
<script src="/lib/angular.js" charset="utf-8"></script>
<script src="/lib/ui-bootstrap-tpls-0.11.0.js" charset="utf-8"></script>
<link rel="stylesheet" type="text/css" href="/lib/bootstrap.css"></link>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<!-- Application -->
<script src="/js/songChartController.js" charset="utf-8"></script>
<script src="/js/songModalController.js" charset="utf-8"></script>
<script>
	var songChartApp = angular.module('songChartApp', ['ui.bootstrap']);
	songChartApp.controller('songChartController', 
		['$scope','$filter','$http','$modal',SongChartController]);
	songChartApp.controller('songModalController', 
		['$scope','$modalInstance',SongModalController]);
</script>
</head>

<script>
</script>

<body data-ng-app="songChartApp" data-ng-controller="songChartController">

<nav role="navigation" class="navbar navbar-default navbar-fixed-top">
        <ul role="navigation" class="nav navbar-nav">
            <li class="dropdown">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.decade}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="decade in [1970,1980,1990] | orderBy: identity" 
						data-ng-click="setFilter({'decade':decade})"
					><a href="#">{{decade}}s</a></li>
                </ul>
			</li>
            <li class="dropdown" data-ng-show="filter.decade > 0">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.year}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="i in [0,1,2,3,4,5,6,7,8,9]" 
						data-ng-click="setFilter({'year':filter.decade+i})"
					><a href="#">{{filter.decade+i}}</a></li>
                </ul>
            </li>
            <li class="dropdown" data-ng-show="filter.year > 0">
                <a href="#" data-toggle="dropdown" class="dropdown-toggle">{{display.month}} <b class="caret"></b></a>
                <ul class="dropdown-menu">
					<li data-ng-repeat="month in months" 
						data-ng-click="setFilter({'year':filter.year,'month':$index+1})"
					><a href="#">{{month}}</a></li>
                </ul>
            </li>
        </ul>
        <ul role="navigation" class="nav navbar-nav navbar-right">			
			<li><a href="#" data-ng-click="reload();">Reload</a></li>
			<li><a href="#" data-ng-click="init();">Reset</a></li>
        </ul>	
</nav>

<br /><br/ ><br/ ><br/ ><!-- spacer to move table underneath nav bar -->

<table class="table table-condensed table-hover" data-ng-show="displayArray.length > 0">
	<thead>
		<tr>
			<th data-ng-show="showRank">Rank</th>
			<th>Title</th>
			<th>Artist</th>
			<th data-ng-show="showDate">Date</th>
			<th data-ng-show="showIsDebut"></th>
			<th data-ng-show="showScore">Score</th>
			<th data-ng-show="showProjectedRank" tooltip="Projected Rank">PR</th>
			<th tooltip-placement="bottom" tooltip="Debut Rank">D</th>
			<th tooltip-placement="bottom" tooltip="Peak Rank">P</th>
			<th tooltip-placement="bottom" tooltip="Duration (Months)">M</th>
			<th tooltip-placement="bottom" tooltip="Ascent Coefficient">A</th>
			<th tooltip-placement="bottom" tooltip="Descent Coefficient">B</th>
		</tr>
	</thead>
	<tbody>
		<tr data-ng-repeat="song in displayArray">
			<td data-ng-show="showRank">{{ $index+1 }}</td>
			<td><a data-ng-click="openSongModal(song)">{{song.title}}</a></td>
			<td><a href="http://playlists.wikidot.com/{{ song.artist }}">{{ song.artistObject.name }}</a></td>
			<td data-ng-show="showDate">{{dateString(song)}}</td>
			<th data-ng-show="showIsDebut"><i class="fa fa-star" data-ng-show="song.isDebut"></i></th>
			<td data-ng-show="showScore">{{formatScore(song.score)}}</td>
			<td data-ng-show="showProjectedRank">{{formatProjectedRank(song.projectedRank)}}</td>
			<td>{{song.debutRank}}</td>
			<td>{{song.peakRank}}</td>
			<td><span data-ng-show="showProjectedRank">{{song.monthIndex}} / </span>{{song.duration}}</td>
			<td>{{format2dp(song.ascentCoefficient)}}</td>
			<td>{{format2dp(song.descentCoefficient)}}</td>
		</tr>
	</tbody>
</table>

<script type="text/ng-template" id="songModal.html">
	<div class="modal-header">
		<h3 class="modal-title">
			<a href="http://playlists.wikidot.com/{{ song.fullname }}">{{song.title}}</a><br>
			<small><a href="http://playlists.wikidot.com/{{ song.artist }}">{{ song.artistObject.name }}</a></small>
		</h3>
	</div>
	<div class="modal-body">
		<table>
			<tr><td>Debut Date</td><td><a href="http://playlists.wikidot.com/{{ song.date }}">{{ song.date }}</a></td></tr>
			<tr><td>Total Score</td><td>{{ song.score | number:2 }}</td></tr>
			<tr><td>Debut Rank</td><td>{{ song.debutRank }}</td></tr>
			<tr><td>Peak Rank</td><td>{{ song.peakRank }}</td></tr>
			<tr><td>Duration</td><td>{{ song.duration }}</td>
			<tr><td>Ascent K</td><td>{{ song.ascentCoefficient | number:2 }}</td>
			<tr><td>Descent K</td><td>{{ song.descentCoefficient | number:2 }}</td>
		</table>
		<p><b>Ranks</b></p>
		<table>
			<tr data-ng-repeat=""><td>date</td><td>value</td></tr>
		</table>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" ng-click="ok()">Close</button>
	</div>
</script>

</body>
</html>